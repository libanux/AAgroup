<!-- ADD OR UPDATE -->
<!-- <mat-card class="cardWithShadow">
  <mat-card-content>
    <div class="InputsWholeRow">
      <div class="inputsInAdd">
        <section>
          <div><input type="text" [(ngModel)]="ADDED_PRODUCT.barcode" placeholder="barcode"></div>
          <div><input type="text" [(ngModel)]="ADDED_PRODUCT.itemName" placeholder="itemName"></div>
        </section>

        <section>
          <div><input type="text" [(ngModel)]="ADDED_PRODUCT.description" placeholder="description"></div>

          <div>
            <mat-form-field class="theme-select2" appearance="outline">
              <mat-select [(ngModel)]="ADDED_PRODUCT.category.CategoryName" placeholder="category">
                <mat-option (click)="OPEN_DIALOG('add category', ADDED_PRODUCT)" class="addNewItem_Option"><a>Add
                    New</a></mat-option>
                @for(category of categoryArray; track category){
                <mat-option [value]="category.CategoryName">{{ category.CategoryName }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>

        </section>

        <section>
          <div><input type="text" [(ngModel)]="ADDED_PRODUCT.cost" placeholder="cost"></div>
          <div><input type="text" [(ngModel)]="ADDED_PRODUCT.sale" placeholder="sale"></div>
        </section>
      </div>

      <div *ngIf="ShowAddButoon">
        <button mat-flat-button color="primary" (click)="ADD_PRODUCT(ADDED_PRODUCT)"> Add Product </button>
      </div>

      <div class="TwoButtons" *ngIf="!ShowAddButoon">
        <button (click)="CANCEL_UPDATE()" mat-flat-button color="primary">Cancel</button>
        <button mat-flat-button color="primary" (click)="UPDATE_PRODUCT(ADDED_PRODUCT)">Update</button>
      </div>

    </div>
  </mat-card-content>
</mat-card> -->


<mat-card class="cardWithShadow theme-card">
  <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start" animationDuration="0ms">
    <mat-tab label="Create purchase">
      <mat-card-content>
        <div class="row">


          <!-- Supplier -->
          <div class="col-md-4 d-flex flex-column">
            <div class="d-flex align-items-center">
              <mat-label class="mat-subtitle-2 f-w-600 d-block m-b-16">Supplier</mat-label>
            </div>
            <mat-form-field appearance="outline" class="w-100">
              <mat-select value="en">
                <mat-option value="en">John Doe</mat-option>
                <mat-option value="fr">Micheal Doe</mat-option>
                <mat-option value="new" class="fixed-option">
                  <div class="option-content">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-20 d-flex" height="24px"
                      viewBox="0 -960 960 960" width="24px" fill="#5c8305">
                      <path
                        d="M720-400v-120H600v-80h120v-120h80v120h120v80H800v120h-80Zm-360-80q-66 0-113-47t-47-113q0-66 47-113t113-47q66 0 113 47t47 113q0 66-47 113t-113 47ZM40-160v-112q0-34 17.5-62.5T104-378q62-31 126-46.5T360-440q66 0 130 15.5T616-378q29 15 46.5 43.5T680-272v112H40Zm80-80h480v-32q0-11-5.5-20T580-306q-54-27-109-40.5T360-360q-56 0-111 13.5T140-306q-9 5-14.5 14t-5.5 20v32Zm240-320q33 0 56.5-23.5T440-640q0-33-23.5-56.5T360-720q-33 0-56.5 23.5T280-640q0 33 23.5 56.5T360-560Zm0-80Zm0 400Z" />
                    </svg>
                    <span>Add new supplier</span>
                  </div>
                </mat-option>
              </mat-select>
              <mat-icon matPrefix class="op-5">
                <i-tabler name="user" class="icon-20 d-flex"></i-tabler>
              </mat-icon>
            </mat-form-field>
          </div>

          <!-- Invoice No. -->
          <div class="col-md-4 d-flex flex-column">
            <div class="d-flex align-items-center">
              <mat-label class="mat-subtitle-2 f-w-600 d-block m-b-16">Invoice No.</mat-label>
            </div>
            <mat-form-field appearance="outline" class="w-100">
              <input matInput placeholder="11446688" />
              <mat-icon matPrefix class="op-5">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon-20 d-flex" height="24px" viewBox="0 -960 960 960"
                  width="24px" fill="#5f6368">
                  <path
                    d="M160-640h640v-80H160v80Zm-80-80q0-33 23.5-56.5T160-800h640q33 0 56.5 23.5T880-720v240H160v240h164v80H160q-33 0-56.5-23.5T80-240v-480ZM598-80 428-250l56-56 114 112 226-226 56 58L598-80ZM160-720v480-180 113-413Z" />
                </svg>
              </mat-icon>
            </mat-form-field>
          </div>

          <!-- Purchase Date -->
          <div class="col-md-4 d-flex flex-column">
            <div class="d-flex align-items-center">
              <mat-label class="mat-subtitle-2 f-w-600 d-block m-b-16">Purchase Date</mat-label>
            </div>
            <mat-form-field appearance="outline" class="w-100">
              <input matInput [matDatepicker]="birthpicker3" placeholder="13-6-2024" />
              <mat-icon matPrefix class="op-5">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon-20 d-flex" height="24px" viewBox="0 -960 960 960"
                  width="24px" fill="#5f6368">
                  <path
                    d="M200-80q-33 0-56.5-23.5T120-160v-560q0-33 23.5-56.5T200-800h40v-80h80v80h320v-80h80v80h40q33 0 56.5 23.5T840-720v560q0 33-23.5 56.5T760-80H200Zm0-80h560v-400H200v400Zm0-480h560v-80H200v80Zm0 0v-80 80Zm280 240q-17 0-28.5-11.5T440-440q0-17 11.5-28.5T480-480q17 0 28.5 11.5T520-440q0 17-11.5 28.5T480-400Zm-160 0q-17 0-28.5-11.5T280-440q0-17 11.5-28.5T320-480q17 0 28.5 11.5T360-440q0 17-11.5 28.5T320-400Zm320 0q-17 0-28.5-11.5T600-440q0-17 11.5-28.5T640-480q17 0 28.5 11.5T680-440q0 17-11.5 28.5T640-400ZM480-240q-17 0-28.5-11.5T440-280q0-17 11.5-28.5T480-320q17 0 28.5 11.5T520-280q0 17-11.5 28.5T480-240Zm-160 0q-17 0-28.5-11.5T280-280q0-17 11.5-28.5T320-320q17 0 28.5 11.5T360-280q0 17-11.5 28.5T320-240Zm320 0q-17 0-28.5-11.5T600-280q0-17 11.5-28.5T640-320q17 0 28.5 11.5T680-280q0 17-11.5 28.5T640-240Z" />
                </svg>
              </mat-icon>
              <mat-datepicker-toggle matIconSuffix [for]="birthpicker3"></mat-datepicker-toggle>
              <mat-datepicker #birthpicker3></mat-datepicker>
            </mat-form-field>
          </div>
        </div>
        <div class="m-t-12 text-right">
          <button mat-flat-button color="primary">Create</button>
          <button mat-flat-button color="warn" class="m-l-8">Cancel</button>
        </div>
      </mat-card-content>
    </mat-tab>
  </mat-tab-group>
</mat-card>


<!-- WHOLE TABLE -->
<mat-card class="cardWithShadow">

  <!-- TABLE HEADER -->
  <header>
    <!-- SEARCH -->
    <div class="searchbar">
      <mat-form-field appearance="outline" class="hide-hint custom-search ">
        <input matInput (keyup)="APPLY_SEARCH_FILTER($any($event.target).value)" placeholder="Search Product's" />
        <mat-icon matSuffix><i-tabler name="search" class="icon-15"></i-tabler></mat-icon>
      </mat-form-field>
    </div>

    <!-- DROPDOWN -->
    <div class="filter-div">

      <div>
        <mat-form-field class="theme-select" appearance="outline">
          <mat-select [(ngModel)]="selectedMonth" (selectionChange)="ON_CHANGE_DROPDOWN($event.value)"
            placeholder="Today">
            <mat-option *ngFor="let month of months" [value]="month.value">{{ month.viewValue }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div>
        <mat-form-field class="theme-select" appearance="outline">
          <mat-select [(ngModel)]="selectedCategory" (selectionChange)="FILTER_BY_CATEGORY($event.value)"
            placeholder="All">
            <mat-option [value]="'All'">All</mat-option>
            <mat-option *ngFor="let category of categoryArray" [value]="category.CategoryName">{{ category.CategoryName
              }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

    </div>

  </header>

  <mat-card-content>

    <!-- TABLE BODY -->
    <div class="table-responsive">
      <table mat-table [dataSource]="productsArray" multiTemplateDataRows>

        <!-- Iterate over displayedColumns using ngFor -->
        <ng-container *ngFor="let column of displayedColumns;">

          <ng-container matColumnDef="{{ column }}">

            @if(column == 'cost' || column == 'sale'){
            <th mat-header-cell *matHeaderCellDef class="icon_th" (click)="SORT_COST()">
              {{ column | titlecase }}
              <!-- @if(column == 'cost'){ -->
              <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"
                fill="#000000">
                <path
                  d="M324-432v-294L219-621l-51-51 192-192 192 192-51 51-105-105v294h-72ZM600-96 408-288l51-51 105 105v-294h72v294l105-105 51 51L600-96Z" />
              </svg>
              <!-- } -->
            </th>
            }

            @else{
            <th mat-header-cell *matHeaderCellDef>
              {{ column | titlecase }}
              @if(column == 'cost'){
              <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"
                fill="#000000">
                <path
                  d="M324-432v-294L219-621l-51-51 192-192 192 192-51 51-105-105v294h-72ZM600-96 408-288l51-51 105 105v-294h72v294l105-105 51 51L600-96Z" />
              </svg>
              }
            </th>
            }

            <td mat-cell *matCellDef="let element" (click)="expandRow($event, element, column)">

              <!-- Check if the column is 'status' -->
              <ng-container *ngIf="column !== 'action'; else actionColumn">
                <ng-container *ngIf="column !== 'barcode'; else barcodeColumn">
                  <ng-container *ngIf="column !== 'description'; else descriptionColumn">
                    <ng-container *ngIf="column !== 'category'; else categoryColumn">
                      <ng-container *ngIf="column !== 'cost'; else costColumn">
                        {{ element[column] }}
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>
              </ng-container>

              <!-- Apply specific design if the column is 'status' -->
              <ng-template #barcodeColumn>{{ element[column] }}</ng-template>
              <ng-template #categoryColumn>{{ (element[column]).CategoryName }}</ng-template>
              <ng-template #costColumn>$ {{ element[column] }}</ng-template>
              <ng-template #descriptionColumn>{{ TRUNCATE_TEXT(element[column], 20) }}</ng-template>

              <ng-template #actionColumn>
                <div class="action-link">
                  <a (click)="EDIT_PRODUCT(element)"><i-tabler name="edit" class="icon-18"></i-tabler></a>
                  <a (click)="OPEN_DIALOG('Delete',element)"><i-tabler name="trash" class="icon-18"></i-tabler></a>
                </div>
              </ng-template>

            </td>

          </ng-container>

        </ng-container>

        <!-- EXPANDED ROW DETAILS -->
        <ng-container matColumnDef="expandedDetail">
          <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
            <div [@detailExpand]="element === expandedElement ? 'expanded' : 'collapsed'">
              <div class="details-container p-3 rounded border mb-3 mx-2">
                <div class="detail-body mt-3">
                  <div class="col-md-4">
                    <div class="detail-field"><strong>category:</strong> {{ element.category.categoryName }}</div>
                    <div class="detail-field"><strong>itemName:</strong> {{ element.itemName }}</div>
                    <div class="detail-field"><strong>description:</strong> {{ element.description }}</div>
                  </div>
                  <div class="col-md-4">
                    <div class="detail-field"><strong>cost:</strong> {{ element.cost }}</div>
                    <div class="detail-field"><strong>sale:</strong> {{ element.sale }}</div>
                  </div>

                  <div class="col-md-4">
                    <div class="detail-field QR">
                      <strong>barcode: {{ element.barcode }}</strong>
                      <svg xmlns="http://www.w3.org/2000/svg" height="60px" width="60px" viewBox="0 -960 960 960"
                        fill="#000000">
                        <path
                          d="M48-192v-576h72v576H48Zm120 0v-576h72v576h-72Zm120 0v-576h48v576h-48Zm120 0v-576h72v576h-72Zm120 0v-576h96v576h-96Zm144 0v-576h48v576h-48Zm144 0v-576h96v576h-96Z" />
                      </svg>
                    </div>
                  </div>
                </div>

                <div class="btns-div">
                  <button class="invoice-btn">Print invoice</button>

                  <button class="invoice-btn">
                    <svg width="2" viewBox="0 0 512 512" version="1.1" xmlns="http://www.w3.org/2000/svg"
                      xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000">
                      <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                      <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                      <g id="SVGRepo_iconCarrier">
                        <title>pdf-document</title>
                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                          <g id="add" fill="#000000" transform="translate(85.333333, 42.666667)">
                            <path
                              d="M75.9466667,285.653333 C63.8764997,278.292415 49.6246897,275.351565 35.6266667,277.333333 L1.42108547e-14,277.333333 L1.42108547e-14,405.333333 L28.3733333,405.333333 L28.3733333,356.48 L40.5333333,356.48 C53.1304778,357.774244 65.7885986,354.68506 76.3733333,347.733333 C85.3576891,340.027178 90.3112817,328.626053 89.8133333,316.8 C90.4784904,304.790173 85.3164923,293.195531 75.9466667,285.653333 L75.9466667,285.653333 Z M53.12,332.373333 C47.7608867,334.732281 41.8687051,335.616108 36.0533333,334.933333 L27.7333333,334.933333 L27.7333333,298.666667 L36.0533333,298.666667 C42.094796,298.02451 48.1897668,299.213772 53.5466667,302.08 C58.5355805,305.554646 61.3626692,311.370371 61.0133333,317.44 C61.6596233,323.558965 58.5400493,329.460862 53.12,332.373333 L53.12,332.373333 Z M150.826667,277.333333 L115.413333,277.333333 L115.413333,405.333333 L149.333333,405.333333 C166.620091,407.02483 184.027709,403.691457 199.466667,395.733333 C216.454713,383.072462 225.530463,362.408923 223.36,341.333333 C224.631644,323.277677 218.198313,305.527884 205.653333,292.48 C190.157107,280.265923 170.395302,274.806436 150.826667,277.333333 L150.826667,277.333333 Z M178.986667,376.32 C170.098963,381.315719 159.922142,383.54422 149.76,382.72 L144.213333,382.72 L144.213333,299.946667 L149.333333,299.946667 C167.253333,299.946667 174.293333,301.653333 181.333333,308.053333 C189.877212,316.948755 194.28973,329.025119 193.493333,341.333333 C194.590843,354.653818 189.18793,367.684372 178.986667,376.32 L178.986667,376.32 Z M254.506667,405.333333 L283.306667,405.333333 L283.306667,351.786667 L341.333333,351.786667 L341.333333,329.173333 L283.306667,329.173333 L283.306667,299.946667 L341.333333,299.946667 L341.333333,277.333333 L254.506667,277.333333 L254.506667,405.333333 L254.506667,405.333333 Z M234.666667,7.10542736e-15 L9.52127266e-13,7.10542736e-15 L9.52127266e-13,234.666667 L42.6666667,234.666667 L42.6666667,192 L42.6666667,169.6 L42.6666667,42.6666667 L216.96,42.6666667 L298.666667,124.373333 L298.666667,169.6 L298.666667,192 L298.666667,234.666667 L341.333333,234.666667 L341.333333,106.666667 L234.666667,7.10542736e-15 L234.666667,7.10542736e-15 Z"
                              id="document-pdf"> </path>
                          </g>
                        </g>
                      </g>
                    </svg>
                    Print PDF
                  </button>

                  <button class="invoice-btn">Print Excel</button>
                </div>
              </div>
            </div>
          </td>
        </ng-container>


        <!-- HEADER AND ROW DEFINITIONS -->
        <tr mat-header-row *matHeaderRowDef="columnsToDisplayWithExpand"></tr>
        <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand" class="example-element-row"
          [class.example-expanded-row]="expandedElement === element"
          (click)="expandedElement = expandedElement === element ? null : element;">
        </tr>
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>

      </table>
    </div>

    <!-- TABLE PAGINATION -->
    <mat-paginator [pageSizeOptions]="[10, 20, 30]" showFirstLastButtons>
    </mat-paginator>
  </mat-card-content>
</mat-card>